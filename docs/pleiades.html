---

title: Pleiades

keywords: fastai
sidebar: home_sidebar

summary: "Working through conversion to cogs, upload to object storage, stac item metadata parsing, etc. for pleiades datasets"
description: "Working through conversion to cogs, upload to object storage, stac item metadata parsing, etc. for pleiades datasets"
nb_path: "01A_pleiades.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01A_pleiades.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Preparation:-Download,-cloud-optimise,-upload"><strong>Preparation</strong>: <strong><em>Download, cloud-optimise, upload</em></strong><a class="anchor-link" href="#Preparation:-Download,-cloud-optimise,-upload"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prep-Function"><strong>Prep Function</strong><a class="anchor-link" href="#Prep-Function"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Download and use basic gdal tools to mosaic any tiles into single images, convert to cog and upload to our object storage.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prep_pleiades" class="doc_header"><code>prep_pleiades</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prep_pleiades</code>(<strong><code>sedas_supplierId</code></strong>, <strong><code>inter_dir</code></strong>=<em><code>'/tmp/data/intermediate/'</code></em>, <strong><code>s3_bucket</code></strong>=<em><code>'public-eo-data'</code></em>, <strong><code>s3_dir</code></strong>=<em><code>'uksa-ssgp/pleiades/'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Iteration-with-examples"><strong>Iteration with examples</strong><a class="anchor-link" href="#Iteration-with-examples"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Some samples used to iterate creation of the prep function.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">sedas_find_datasets</span><span class="p">(</span><span class="s2">&quot;POLYGON((-1.91 51.81,-1.15 51.81,-1.15 51.50,-1.91 51.50,-1.91 51.81))&quot;</span><span class="p">,</span> 
                             <span class="s2">&quot;2000-01-01T00:00:00Z&quot;</span><span class="p">,</span> 
                             <span class="s2">&quot;2020-10-27T00:00:00Z&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Pleiades&quot;</span>
                            <span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>productId</th>
      <th>supplierId</th>
      <th>type</th>
      <th>satelliteName</th>
      <th>instrumentName</th>
      <th>modeName</th>
      <th>sensorType</th>
      <th>sensorResolution</th>
      <th>coordinatesWKT</th>
      <th>start</th>
      <th>...</th>
      <th>area</th>
      <th>aoiCoveragePercent</th>
      <th>usefulAreaPercent</th>
      <th>cloudCoveragePercent</th>
      <th>productType</th>
      <th>latency</th>
      <th>ql</th>
      <th>thumbnail</th>
      <th>vendorSpecific</th>
      <th>downloadUrl</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>c0ec9a5f12356e87bc910ddbc49dbb76</td>
      <td>Pleiades_UKSA396_SO18034616-96-01_DS_PHR1B_201...</td>
      <td>ARCHIVE</td>
      <td>Pleiades-1B</td>
      <td>MS/PAN</td>
      <td>0.000</td>
      <td>Optical</td>
      <td>2.0</td>
      <td>POLYGON((-1.654728 51.309517,-1.345414 51.3081...</td>
      <td>2018-10-24T11:17:22Z</td>
      <td>...</td>
      <td>4.825125e+08</td>
      <td>1.0</td>
      <td>5.0</td>
      <td>0.0</td>
      <td>L3</td>
      <td>Standard</td>
      <td>https://geobrowser.satapps.org/archiveql/aeweb...</td>
      <td>https://sedasdm.satapps.org/qls/qlmgr.php?scen...</td>
      <td>{'property': 'vendorSpecific', 'Filehash': 'cf...</td>
      <td>https://sedasdm.satapps.org/datamgr/datamgr.ph...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>94cc7887414be0912de7ca44288f79da</td>
      <td>Pleiades_UKSA174_SO18034614-74-01_DS_PHR1A_201...</td>
      <td>ARCHIVE</td>
      <td>Pleiades-1A</td>
      <td>MS/PAN</td>
      <td>0.000</td>
      <td>Optical</td>
      <td>2.0</td>
      <td>POLYGON((-2.153852 51.603313,-1.841533 51.6033...</td>
      <td>2018-09-29T11:10:08Z</td>
      <td>...</td>
      <td>1.565260e+08</td>
      <td>2.0</td>
      <td>22.0</td>
      <td>0.0</td>
      <td>L3</td>
      <td>Standard</td>
      <td>https://geobrowser.satapps.org/archiveql/aeweb...</td>
      <td>https://sedasdm.satapps.org/qls/qlmgr.php?scen...</td>
      <td>{'property': 'vendorSpecific', 'Filehash': '4b...</td>
      <td>https://sedasdm.satapps.org/datamgr/datamgr.ph...</td>
    </tr>
  </tbody>
</table>
<p>2 rows Ã— 22 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Example of testing the first one.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">done</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Pleiades_UKSA7_SO18034613-7-01_DS_PHR1A_201802241127550_FR1_PX_W002N51_0711_024843613631101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pleiades_UKSA305_SO18034616-5-01_DS_PHR1B_201807241124303_FR1_PX_W002N51_0720_01561TPP1601069279&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pleiades_UKSA341_SO18034616-41-01_DS_PHR1B_201809021117346_FR1_PX_W002N51_1008_03279TPP1601069492&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pleiades_UKSA396_SO18034616-96-01_DS_PHR1B_201810241117221_FR1_PX_W002N51_0710_01712TPP1601069318&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pleiades_UKSA396_SO18034616-96-01_DS_PHR1B_201810241117221_FR1_PX_W002N51_0710_01712&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Full-Job-Lists"><strong>Full Job Lists</strong><a class="anchor-link" href="#Full-Job-Lists"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once happy with <a href="/sac_stac/01A_pleiades#prep_pleiades"><code>prep_pleiades</code></a> we create a list of jobs from search results of <a href="/sac_stac/utils#sedas_find_datasets"><code>sedas_find_datasets</code></a> to submit to a redis queue as per <code>rediswq</code>.</p>
<p>We can test these via redis within <code>pleiades_prep_worker</code>.</p>
<p>Sometimes we run as campaigns via K8s.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">jobs_dir</span> <span class="o">=</span> <span class="s2">&quot;/tmp/data/&quot;</span>
<span class="n">td</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
<span class="n">td</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">td</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%m&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">td</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">td</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;20201111&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jobs_dir</span><span class="si">}</span><span class="s2">/JOBLIST_</span><span class="si">{</span><span class="n">td</span><span class="si">}</span><span class="s2">_pleiades.txt&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">supplierId</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;rpush jobPL&quot;</span><span class="o">+</span><span class="s2">&quot; &#39;{&quot;</span><span class="o">+</span><span class="s1">&#39;&quot;sedas_supplierId&quot;: &quot;&#39;</span><span class="o">+</span> <span class="n">v</span> <span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="s2">&quot;}&#39;&quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="STAC-metadata:-core-&amp;-extensions"><strong>STAC metadata</strong>: <strong><em>core &amp; extensions</em></strong><a class="anchor-link" href="#STAC-metadata:-core-&amp;-extensions"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With the cogs above hosted object storage we can go create some tools for building a STAC <em>Collection</em> from them, to be used within in <strong>insert nb</strong> to build a <em>Catalog</em> of different Catapult <em>Collections</em>. As per the nb these initially sit within a <em>static</em> STAC alongside the actual datasets on the object storage. However we plan on hosting via a STAC compliant API - probs <a href="https://pygeoapi.io/">pygeoapi</a>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">obj_paths_list</span> <span class="o">=</span> <span class="n">s3_list_objects_paths</span><span class="p">(</span><span class="s1">&#39;public-eo-data&#39;</span><span class="p">,</span> <span class="s1">&#39;uksa-ssgp/pleiades/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scene_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_paths_list</span> <span class="p">]))</span>
<span class="n">scene_names</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101&#39;,
 &#39;Pleiades_UKSA174_SO18034614-74-01_DS_PHR1A_201809291110083_FR1_PX_W002N51_0116_00596TPP1601069431&#39;,
 &#39;Pleiades_UKSA204_SO18034615-4-01_DS_PHR1B_201802251121249_FR1_PX_W002N51_0314_01048&#39;,
 &#39;Pleiades_UKSA204_SO18034615-4-01_DS_PHR1B_201802251121249_FR1_PX_W002N51_0314_010483613775101&#39;,
 &#39;Pleiades_UKSA305_SO18034616-5-01_DS_PHR1B_201807241124303_FR1_PX_W002N51_0720_01561TPP1601069279&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Individual-example-for-iteration"><strong>Individual example for iteration</strong><a class="anchor-link" href="#Individual-example-for-iteration"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>can just work with one</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scene_name</span> <span class="o">=</span> <span class="n">scene_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">scene_name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and objects associated with that scene</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">scene_obj_paths</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_paths_list</span> <span class="k">if</span> <span class="n">scene_name</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
<span class="n">scene_obj_paths</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/DELIVERY.PDF&#39;,
 &#39;uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_MS_002/DIM_PHR1A_MS_201809291110008_ORT_3614104101-2.XML&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>set our own I/O for pystac</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Functions-for-Item-metadata"><strong>Functions for</strong> <strong><em>Item</em></strong> <strong>metadata</strong><a class="anchor-link" href="#Functions-for-Item-metadata"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_get_dt" class="doc_header"><code>pleiades_get_dt</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L56" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_get_dt</code>(<strong><code>scene_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_get_dt</span><span class="p">(</span><span class="n">scene_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>datetime.datetime(2018, 9, 29, 11, 10)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_parsemeta" class="doc_header"><code>pleiades_parsemeta</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_parsemeta</code>(<strong><code>scene_name</code></strong>, <strong><code>scene_obj_paths</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">meta</span> <span class="o">=</span> <span class="n">pleiades_parsemeta</span><span class="p">(</span><span class="n">scene_name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
<span class="n">meta</span><span class="p">[</span><span class="s1">&#39;Dimap_Document&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>odict_keys([&#39;Metadata_Identification&#39;, &#39;Dataset_Identification&#39;, &#39;Dataset_Content&#39;, &#39;Product_Information&#39;, &#39;Coordinate_Reference_System&#39;, &#39;Geoposition&#39;, &#39;Processing_Information&#39;, &#39;Raster_Data&#39;, &#39;Radiometric_Data&#39;, &#39;Geometric_Data&#39;, &#39;Quality_Assessment&#39;, &#39;Dataset_Sources&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_get_crs" class="doc_header"><code>pleiades_get_crs</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_get_crs</code>(<strong><code>metadata</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">crs</span> <span class="o">=</span> <span class="n">pleiades_get_crs</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
<span class="n">crs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>27700</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_get_geom" class="doc_header"><code>pleiades_get_geom</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L69" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_get_geom</code>(<strong><code>scene_paths</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_get_geom</span><span class="p">(</span><span class="n">scene_obj_paths</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;type&#39;: &#39;Polygon&#39;,
 &#39;coordinates&#39;: [[[-1.7162111146081491, 51.703447752207374],
   [-1.6539393674716631, 51.70305171212088],
   [-1.5922000556276548, 51.7022918404328],
   [-1.592478005824943, 51.66971308516982],
   [-1.5923937686249074, 51.660564184797174],
   [-1.5924483796708082, 51.65689143996495],
   [-1.5923435803877832, 51.6484257860413],
   [-1.5925225669770522, 51.629252456312805],
   [-1.6313240498998447, 51.629686309100045],
   [-1.6617769179346535, 51.62994873863878],
   [-1.715447257136181, 51.63018534903567],
   [-1.7483946591920845, 51.630161588463274],
   [-1.7789150489058498, 51.63009707066823],
   [-1.8369443638514822, 51.62966137158252],
   [-1.8706869752457782, 51.629244747190995],
   [-1.902984365251201, 51.62878127998801],
   [-1.9031756192477154, 51.64416997236793],
   [-1.9032281966762568, 51.65003679955556],
   [-1.9031830688830722, 51.650868451669226],
   [-1.9032398631646559, 51.65134952934474],
   [-1.9032635080951406, 51.6606374853309],
   [-1.903368845801305, 51.668909487362704],
   [-1.9033307786452263, 51.669813072279545],
   [-1.903389897227946, 51.672618376007144],
   [-1.9033553365867595, 51.675275246793404],
   [-1.9033978059631684, 51.67570685904059],
   [-1.9034325966702832, 51.686577233067496],
   [-1.9034135338037725, 51.70237469751975],
   [-1.8756005685839259, 51.70273072943466],
   [-1.841058256714323, 51.703111743030504],
   [-1.8120077713741385, 51.703302690300696],
   [-1.7785580302502193, 51.703473760830654],
   [-1.7162111146081491, 51.703447752207374]]]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_get_bbox" class="doc_header"><code>pleiades_get_bbox</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L75" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_get_bbox</code>(<strong><code>metadata</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_get_bbox</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[-1.903199885312827, 51.62869184186537, -1.592242985175717, 51.70382196570706]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_get_gsd" class="doc_header"><code>pleiades_get_gsd</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L81" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_get_gsd</code>(<strong><code>metadata</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_get_gsd</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.74</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="pleiades_get_cloudcover" class="doc_header"><code>pleiades_get_cloudcover</code><a href="https://github.com/tjones1993/sac_stac/tree/master/sac_stac/pleiades.py#L87" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pleiades_get_cloudcover</code>(<strong><code>metadata</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_get_cloudcover</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.0</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Can now create</strong> <strong><em>Item</em></strong> <strong>containing core STAC metadata.</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pleiades_create_item</span><span class="p">(</span><span class="n">scene_name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">):</span>

    <span class="n">meta</span> <span class="o">=</span> <span class="n">pleiades_parsemeta</span><span class="p">(</span><span class="n">scene_name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>

    <span class="n">crs</span> <span class="o">=</span> <span class="n">pleiades_get_crs</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

    <span class="n">item</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">Item</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">scene_name</span><span class="p">,</span>
                      <span class="n">datetime</span><span class="o">=</span><span class="n">pleiades_get_dt</span><span class="p">(</span><span class="n">scene_name</span><span class="p">),</span>
                      <span class="n">geometry</span><span class="o">=</span><span class="n">pleiades_get_geom</span><span class="p">(</span><span class="n">scene_obj_paths</span><span class="p">),</span>
                      <span class="n">bbox</span><span class="o">=</span><span class="n">pleiades_get_bbox</span><span class="p">(</span><span class="n">meta</span><span class="p">),</span>
                      <span class="n">properties</span><span class="o">=</span><span class="p">{})</span>

    <span class="n">item</span><span class="o">.</span><span class="n">common_metadata</span><span class="o">.</span><span class="n">gsd</span> <span class="o">=</span> <span class="n">pleiades_get_gsd</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

    <span class="n">item</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;eo&#39;</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">eo</span><span class="o">.</span><span class="n">cloud_cover</span> <span class="o">=</span> <span class="n">pleiades_get_cloudcover</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

    <span class="n">item</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;projection&#39;</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">projection</span><span class="o">.</span><span class="n">epsg</span> <span class="o">=</span> <span class="n">pleiades_get_crs</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">item</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_item</span> <span class="o">=</span> <span class="n">pleiades_create_item</span><span class="p">(</span><span class="n">scene_name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
<span class="n">example_item</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_item</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;type&#39;: &#39;Feature&#39;,
 &#39;stac_version&#39;: &#39;1.0.0-beta.2&#39;,
 &#39;id&#39;: &#39;Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101&#39;,
 &#39;properties&#39;: {&#39;gsd&#39;: 0.74,
  &#39;eo:cloud_cover&#39;: 0.0,
  &#39;proj:epsg&#39;: 27700,
  &#39;datetime&#39;: &#39;2018-09-29T11:10:00Z&#39;},
 &#39;geometry&#39;: {&#39;type&#39;: &#39;Polygon&#39;,
  &#39;coordinates&#39;: [[[-1.7162111146081491, 51.703447752207374],
    [-1.6539393674716631, 51.70305171212088],
    [-1.5922000556276548, 51.7022918404328],
    [-1.592478005824943, 51.66971308516982],
    [-1.5923937686249074, 51.660564184797174],
    [-1.5924483796708082, 51.65689143996495],
    [-1.5923435803877832, 51.6484257860413],
    [-1.5925225669770522, 51.629252456312805],
    [-1.6313240498998447, 51.629686309100045],
    [-1.6617769179346535, 51.62994873863878],
    [-1.715447257136181, 51.63018534903567],
    [-1.7483946591920845, 51.630161588463274],
    [-1.7789150489058498, 51.63009707066823],
    [-1.8369443638514822, 51.62966137158252],
    [-1.8706869752457782, 51.629244747190995],
    [-1.902984365251201, 51.62878127998801],
    [-1.9031756192477154, 51.64416997236793],
    [-1.9032281966762568, 51.65003679955556],
    [-1.9031830688830722, 51.650868451669226],
    [-1.9032398631646559, 51.65134952934474],
    [-1.9032635080951406, 51.6606374853309],
    [-1.903368845801305, 51.668909487362704],
    [-1.9033307786452263, 51.669813072279545],
    [-1.903389897227946, 51.672618376007144],
    [-1.9033553365867595, 51.675275246793404],
    [-1.9033978059631684, 51.67570685904059],
    [-1.9034325966702832, 51.686577233067496],
    [-1.9034135338037725, 51.70237469751975],
    [-1.8756005685839259, 51.70273072943466],
    [-1.841058256714323, 51.703111743030504],
    [-1.8120077713741385, 51.703302690300696],
    [-1.7785580302502193, 51.703473760830654],
    [-1.7162111146081491, 51.703447752207374]]]},
 &#39;links&#39;: [],
 &#39;assets&#39;: {},
 &#39;bbox&#39;: [-1.903199885312827,
  51.62869184186537,
  -1.592242985175717,
  51.70382196570706],
 &#39;stac_extensions&#39;: [&#39;eo&#39;, &#39;projection&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Functions-for-Asset-metadata"><strong>Functions for</strong> <strong><em>Asset</em></strong> <strong>metadata</strong><a class="anchor-link" href="#Functions-for-Asset-metadata"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Once we have <em>Item</em> level metadata we can add the actual <em>Assets</em>. There are a few constants used within these functions at the <em>Item</em> level (i.e. band info) and criteria for finding within the object paths.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_band_refs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;Panchromatic&#39;: {&#39;ends&#39;: &#39;_band1&#39;, &#39;dif&#39;: &#39;_P_&#39;, &#39;id&#39;: &#39;B0&#39;},
 &#39;Blue&#39;: {&#39;ends&#39;: &#39;_band1&#39;, &#39;dif&#39;: &#39;_MS_&#39;, &#39;id&#39;: &#39;B1&#39;},
 &#39;Green&#39;: {&#39;ends&#39;: &#39;_band2&#39;, &#39;dif&#39;: &#39;_MS_&#39;, &#39;id&#39;: &#39;B2&#39;},
 &#39;Red&#39;: {&#39;ends&#39;: &#39;_band3&#39;, &#39;dif&#39;: &#39;_MS_&#39;, &#39;id&#39;: &#39;B3&#39;},
 &#39;Near-Infrared&#39;: {&#39;ends&#39;: &#39;_band4&#39;, &#39;dif&#39;: &#39;_MS_&#39;, &#39;id&#39;: &#39;B4&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Need to find the actual asset path for a given band. (Note that we typically store COGs per-band.)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pleiades_find_band_path</span><span class="p">(</span><span class="n">band_name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">):</span>
    <span class="n">matched_paths</span> <span class="o">=</span> <span class="p">[</span> <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">scene_obj_paths</span> <span class="k">if</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pleiades_band_refs</span><span class="p">[</span><span class="n">band_name</span><span class="p">][</span><span class="s1">&#39;ends&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.tif&quot;</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pleiades_band_refs</span><span class="p">[</span><span class="n">band_name</span><span class="p">][</span><span class="s1">&#39;dif&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">o</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched_paths</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found too many matches: </span><span class="si">{</span><span class="n">matched_paths</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1">#     elif len(matched_paths) == 0: # should probably add something for when no asset is found...</span>
<span class="c1">#         raise Warning(f&quot;&quot;)</span>
    <span class="k">return</span> <span class="n">matched_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pleiades_find_band_path</span><span class="p">(</span><span class="s1">&#39;Blue&#39;</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_MS_002/IMG_PHR1A_MS_201809291110008_ORT_36141041_band1.tif&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then we can add each asset expected to be found and test with the example item taken from above.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pleiades_add_assets2item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">pleiades_bands</span><span class="p">:</span>
<span class="c1">#         print(band.name)</span>

        <span class="n">band_path</span> <span class="o">=</span> <span class="n">pleiades_find_band_path</span><span class="p">(</span><span class="n">band</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
        <span class="n">band_url</span> <span class="o">=</span> <span class="n">create_uri</span><span class="p">(</span><span class="n">band_path</span><span class="p">)</span>
<span class="c1">#         print(band_url)</span>

        <span class="n">asset</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">Asset</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="n">band_url</span><span class="p">,</span> <span class="n">media_type</span><span class="o">=</span><span class="n">pystac</span><span class="o">.</span><span class="n">MediaType</span><span class="o">.</span><span class="n">COG</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">eo</span><span class="o">.</span><span class="n">set_bands</span><span class="p">([</span><span class="n">band</span><span class="p">],</span> <span class="n">asset</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">add_asset</span><span class="p">(</span><span class="n">pleiades_band_refs</span><span class="p">[</span><span class="n">band</span><span class="o">.</span><span class="n">name</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">asset</span><span class="p">)</span>    
        
    <span class="k">return</span> <span class="n">item</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_item_with_assets</span> <span class="o">=</span> <span class="n">pleiades_add_assets2item</span><span class="p">(</span><span class="n">example_item</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can see the completed <em>Item</em> stac record.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_item_with_assets</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_item_with_assets</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;type&#39;: &#39;Feature&#39;,
 &#39;stac_version&#39;: &#39;1.0.0-beta.2&#39;,
 &#39;id&#39;: &#39;Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101&#39;,
 &#39;properties&#39;: {&#39;gsd&#39;: 0.74,
  &#39;eo:cloud_cover&#39;: 0.0,
  &#39;proj:epsg&#39;: 27700,
  &#39;datetime&#39;: &#39;2018-09-29T11:10:00Z&#39;},
 &#39;geometry&#39;: {&#39;type&#39;: &#39;Polygon&#39;,
  &#39;coordinates&#39;: [[[-1.7162111146081491, 51.703447752207374],
    [-1.6539393674716631, 51.70305171212088],
    [-1.5922000556276548, 51.7022918404328],
    [-1.592478005824943, 51.66971308516982],
    [-1.5923937686249074, 51.660564184797174],
    [-1.5924483796708082, 51.65689143996495],
    [-1.5923435803877832, 51.6484257860413],
    [-1.5925225669770522, 51.629252456312805],
    [-1.6313240498998447, 51.629686309100045],
    [-1.6617769179346535, 51.62994873863878],
    [-1.715447257136181, 51.63018534903567],
    [-1.7483946591920845, 51.630161588463274],
    [-1.7789150489058498, 51.63009707066823],
    [-1.8369443638514822, 51.62966137158252],
    [-1.8706869752457782, 51.629244747190995],
    [-1.902984365251201, 51.62878127998801],
    [-1.9031756192477154, 51.64416997236793],
    [-1.9032281966762568, 51.65003679955556],
    [-1.9031830688830722, 51.650868451669226],
    [-1.9032398631646559, 51.65134952934474],
    [-1.9032635080951406, 51.6606374853309],
    [-1.903368845801305, 51.668909487362704],
    [-1.9033307786452263, 51.669813072279545],
    [-1.903389897227946, 51.672618376007144],
    [-1.9033553365867595, 51.675275246793404],
    [-1.9033978059631684, 51.67570685904059],
    [-1.9034325966702832, 51.686577233067496],
    [-1.9034135338037725, 51.70237469751975],
    [-1.8756005685839259, 51.70273072943466],
    [-1.841058256714323, 51.703111743030504],
    [-1.8120077713741385, 51.703302690300696],
    [-1.7785580302502193, 51.703473760830654],
    [-1.7162111146081491, 51.703447752207374]]]},
 &#39;links&#39;: [],
 &#39;assets&#39;: {&#39;B0&#39;: {&#39;href&#39;: &#39;http://s3-uk-1.sa-catapult.co.uk/public-eo-data/uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_P_001/IMG_PHR1A_P_201809291110008_ORT_36141041_band1.tif&#39;,
   &#39;type&#39;: &#39;image/tiff; application=geotiff; profile=cloud-optimized&#39;,
   &#39;eo:bands&#39;: [{&#39;name&#39;: &#39;Panchromatic&#39;,
     &#39;common_name&#39;: &#39;pan&#39;,
     &#39;description&#39;: &#39;Panchromatic: 480 - 830 nm&#39;}]},
  &#39;B1&#39;: {&#39;href&#39;: &#39;http://s3-uk-1.sa-catapult.co.uk/public-eo-data/uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_MS_002/IMG_PHR1A_MS_201809291110008_ORT_36141041_band1.tif&#39;,
   &#39;type&#39;: &#39;image/tiff; application=geotiff; profile=cloud-optimized&#39;,
   &#39;eo:bands&#39;: [{&#39;name&#39;: &#39;Blue&#39;,
     &#39;common_name&#39;: &#39;blue&#39;,
     &#39;description&#39;: &#39;Blue: 430 - 550 nm&#39;}]},
  &#39;B2&#39;: {&#39;href&#39;: &#39;http://s3-uk-1.sa-catapult.co.uk/public-eo-data/uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_MS_002/IMG_PHR1A_MS_201809291110008_ORT_36141041_band2.tif&#39;,
   &#39;type&#39;: &#39;image/tiff; application=geotiff; profile=cloud-optimized&#39;,
   &#39;eo:bands&#39;: [{&#39;name&#39;: &#39;Green&#39;,
     &#39;common_name&#39;: &#39;green&#39;,
     &#39;description&#39;: &#39;Green: 490 - 610 nm&#39;}]},
  &#39;B3&#39;: {&#39;href&#39;: &#39;http://s3-uk-1.sa-catapult.co.uk/public-eo-data/uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_MS_002/IMG_PHR1A_MS_201809291110008_ORT_36141041_band3.tif&#39;,
   &#39;type&#39;: &#39;image/tiff; application=geotiff; profile=cloud-optimized&#39;,
   &#39;eo:bands&#39;: [{&#39;name&#39;: &#39;Red&#39;,
     &#39;common_name&#39;: &#39;red&#39;,
     &#39;description&#39;: &#39;Red: 600 - 720 nm&#39;}]},
  &#39;B4&#39;: {&#39;href&#39;: &#39;http://s3-uk-1.sa-catapult.co.uk/public-eo-data/uksa-ssgp/pleiades/Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101/IMG_PHR1A_MS_002/IMG_PHR1A_MS_201809291110008_ORT_36141041_band4.tif&#39;,
   &#39;type&#39;: &#39;image/tiff; application=geotiff; profile=cloud-optimized&#39;,
   &#39;eo:bands&#39;: [{&#39;name&#39;: &#39;Near-Infrared&#39;,
     &#39;common_name&#39;: &#39;nir&#39;,
     &#39;description&#39;: &#39;Near-Infrared: 750 - 950 nm&#39;}]}},
 &#39;bbox&#39;: [-1.903199885312827,
  51.62869184186537,
  -1.592242985175717,
  51.70382196570706],
 &#39;stac_extensions&#39;: [&#39;eo&#39;, &#39;projection&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Compiling-Items-into-a-Collection"><strong>Compiling</strong> <strong><em>Items</em></strong> <strong>into a</strong> <strong><em>Collection</em></strong><a class="anchor-link" href="#Compiling-Items-into-a-Collection"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We naurally want to apply the above tools to all Pleiades-related <em>Items</em> and their <em>Assets</em> in order to build a <em>Collection</em> that can sit within another <em>Collection</em> i.e. comprised of other UKSA/SSGP-procured datasets and maybe an overall Satellite Applications Catapult <em>Catalog</em> covering all of our internal and external-facing geospatial datasets.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">pleiades_create_collection</span><span class="p">(</span><span class="n">pleiades_dir</span><span class="p">,</span> <span class="n">bucket</span><span class="o">=</span><span class="s1">&#39;public-eo-data&#39;</span><span class="p">):</span>
    
    <span class="n">collection_id</span> <span class="o">=</span> <span class="s1">&#39;uksa-ssgp-pleiades&#39;</span>
    <span class="n">collection_title</span> <span class="o">=</span> <span class="s1">&#39;SSGP-procured Pleiades images over the UK&#39;</span>
    <span class="n">collection_description</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;### UKSA / SSGP Pleiades</span>

<span class="s1">    A collection of Pleiades images over the UK. Procured by UKSA under its Space for Smarter Government Programme (SSGP).</span>
<span class="s1">    &#39;&#39;&#39;</span>
    
    <span class="c1"># initially arbitrary as updated later</span>
    <span class="n">spatial_extent</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">SpatialExtent</span><span class="p">([[</span><span class="o">-</span><span class="mf">7.57216793459</span><span class="p">,</span> <span class="mf">49.959999905</span><span class="p">,</span> <span class="mf">1.68153079591</span><span class="p">,</span> <span class="mf">58.6350001085</span><span class="p">]])</span>
    <span class="n">temporal_extent</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">TemporalExtent</span><span class="p">([[</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="kc">None</span><span class="p">]])</span>
    <span class="n">collection_extent</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">Extent</span><span class="p">(</span><span class="n">spatial_extent</span><span class="p">,</span> <span class="n">temporal_extent</span><span class="p">)</span>
    
    <span class="n">collection</span> <span class="o">=</span> <span class="n">pystac</span><span class="o">.</span><span class="n">Collection</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">collection_id</span><span class="p">,</span>
                                   <span class="n">title</span><span class="o">=</span><span class="n">collection_title</span><span class="p">,</span>
                                   <span class="n">description</span><span class="o">=</span><span class="n">collection_description</span><span class="p">,</span>
                                   <span class="n">extent</span><span class="o">=</span><span class="n">collection_extent</span><span class="p">)</span>
    
    <span class="n">collection</span><span class="o">.</span><span class="n">providers</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pystac</span><span class="o">.</span><span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Airbus Defence &amp; Space&#39;</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;producer&#39;</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://www.airbus.com/space.html&#39;</span><span class="p">),</span>
        <span class="n">pystac</span><span class="o">.</span><span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;UK Space Agency&#39;</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;licensor&#39;</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://www.gov.uk/government/organisations/uk-space-agency&#39;</span><span class="p">),</span>
        <span class="n">pystac</span><span class="o">.</span><span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Satellite Applications Catapult&#39;</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;processor&#39;</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://sa.catapult.org.uk/&#39;</span><span class="p">),</span>
        <span class="n">pystac</span><span class="o">.</span><span class="n">Provider</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Satellite Applications Catapult&#39;</span><span class="p">,</span> <span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">],</span> <span class="n">url</span><span class="o">=</span><span class="s1">&#39;https://sa.catapult.org.uk/&#39;</span><span class="p">)</span>
    <span class="p">]</span>
    
    <span class="n">obj_paths_list</span> <span class="o">=</span> <span class="n">s3_list_objects_paths</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">pleiades_dir</span><span class="p">)</span>
    <span class="n">scene_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">([</span> <span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_paths_list</span> <span class="p">]))</span>
    
    <span class="k">for</span> <span class="n">scene_name</span> <span class="ow">in</span> <span class="n">scene_names</span><span class="p">:</span>
        
        <span class="n">scene_obj_paths</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">obj_paths_list</span> <span class="k">if</span> <span class="n">scene_name</span> <span class="ow">in</span> <span class="n">i</span><span class="p">]</span>
        
        <span class="n">item</span> <span class="o">=</span> <span class="n">pleiades_create_item</span><span class="p">(</span><span class="n">scene_name</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">pleiades_add_assets2item</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">scene_obj_paths</span><span class="p">)</span>
        
        <span class="n">collection</span><span class="o">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    
    <span class="n">collection</span><span class="o">.</span><span class="n">update_extent_from_items</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">collection</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_collection</span> <span class="o">=</span> <span class="n">pleiades_create_collection</span><span class="p">(</span><span class="s1">&#39;uksa-ssgp/pleiades/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_collection</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>* &lt;Collection id=uksa-ssgp-pleiades&gt;
  * &lt;Item id=Pleiades_UKSA173_SO18034614-73-01_DS_PHR1A_201809291110008_FR1_PX_W002N51_0417_007113614104101&gt;
  * &lt;Item id=Pleiades_UKSA174_SO18034614-74-01_DS_PHR1A_201809291110083_FR1_PX_W002N51_0116_00596TPP1601069431&gt;
  * &lt;Item id=Pleiades_UKSA204_SO18034615-4-01_DS_PHR1B_201802251121249_FR1_PX_W002N51_0314_010483613775101&gt;
  * &lt;Item id=Pleiades_UKSA305_SO18034616-5-01_DS_PHR1B_201807241124303_FR1_PX_W002N51_0720_01561TPP1601069279&gt;
  * &lt;Item id=Pleiades_UKSA341_SO18034616-41-01_DS_PHR1B_201809021117346_FR1_PX_W002N51_1008_03279TPP1601069492&gt;
  * &lt;Item id=Pleiades_UKSA396_SO18034616-96-01_DS_PHR1B_201810241117221_FR1_PX_W002N51_0710_01712TPP1601069318&gt;
  * &lt;Item id=Pleiades_UKSA7_SO18034613-7-01_DS_PHR1A_201802241127550_FR1_PX_W002N51_0711_024843613631101&gt;
  * &lt;Item id=Pleiades_UKSA87_SO18034613-87-01_DS_PHR1A_201806291118170_FR1_PX_W002N51_1016_029773614015101&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_collection</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;id&#39;: &#39;uksa-ssgp-pleiades&#39;,
 &#39;stac_version&#39;: &#39;1.0.0-beta.2&#39;,
 &#39;description&#39;: &#39;### UKSA / SSGP Pleiades\n\n    A collection of Pleiades images over the UK. Procured by UKSA under its Space for Smarter Government Programme (SSGP).\n    &#39;,
 &#39;links&#39;: [{&#39;rel&#39;: &#39;root&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;},
  {&#39;rel&#39;: &#39;item&#39;, &#39;href&#39;: None, &#39;type&#39;: &#39;application/json&#39;}],
 &#39;title&#39;: &#39;SSGP-procured Pleiades images over the UK&#39;,
 &#39;extent&#39;: {&#39;spatial&#39;: {&#39;bbox&#39;: [[-2.153701453474465,
     51.15439056920768,
     -1.082452236576131,
     51.90716967216828]]},
  &#39;temporal&#39;: {&#39;interval&#39;: [[&#39;2018-02-24T11:27:55Z&#39;,
     &#39;2018-10-24T11:17:22Z&#39;]]}},
 &#39;license&#39;: &#39;proprietary&#39;,
 &#39;providers&#39;: [{&#39;name&#39;: &#39;Airbus Defence &amp; Space&#39;,
   &#39;roles&#39;: [&#39;producer&#39;],
   &#39;url&#39;: &#39;https://www.airbus.com/space.html&#39;},
  {&#39;name&#39;: &#39;UK Space Agency&#39;,
   &#39;roles&#39;: [&#39;licensor&#39;],
   &#39;url&#39;: &#39;https://www.gov.uk/government/organisations/uk-space-agency&#39;},
  {&#39;name&#39;: &#39;Satellite Applications Catapult&#39;,
   &#39;roles&#39;: [&#39;processor&#39;],
   &#39;url&#39;: &#39;https://sa.catapult.org.uk/&#39;},
  {&#39;name&#39;: &#39;Satellite Applications Catapult&#39;,
   &#39;roles&#39;: [&#39;host&#39;],
   &#39;url&#39;: &#39;https://sa.catapult.org.uk/&#39;}]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Note: We normalised hrefs and save in a different notebook.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Export">Export<a class="anchor-link" href="#Export"> </a></h2>
</div>
</div>
</div>
</div>
 

